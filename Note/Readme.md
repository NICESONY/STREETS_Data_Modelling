## 주차 마다 or 학습한 것 노트 or 아이디어 떠오르면 적기

-----------------


### 현재 문제점


## **1. JSON 형식의 구조**

**JSON 데이터**는 교통 사건에 대한 정보를 담고 있으며, 각 사건은 다음과 같은 구조를 가지고 있습니다:

- **사건 ID**: 예를 들어 `"929916"`, `"929919"` 등 고유한 식별자.
- **사건 정보 (`incidents`)**: 각 사건에 대한 상세 정보의 리스트.
  - **coordinate**: 사건 발생 위치의 위도와 경도 `[위도, 경도]`.
  - **event_type**: 사건의 유형 (예: `"Accident"`, `"Debris"`, `"Stall"`, `"Other"`).
  - **impact**: 사건의 영향 정도 (숫자, 예: `1`, `2`, `3`).
  - **direction**: 사건이 발생한 방향 (`"East"`, `"West"`, `"North"`, `"South"` 등).
  - **time**: 사건 발생 시간 (`"YYYY-MM-DD HH:MM:SS"` 형식).
- **affected-sensors**: 해당 사건으로 인해 영향을 받은 센서 ID의 목록.

**예시**:

```json
{
  "929916": {
    "incidents": [
      {
        "coordinate": [42.2395873, -88.0004514],
        "event_type": "Stall",
        "impact": 1,
        "direction": "East",
        "time": "2018-08-20 00:03:30"
      }
    ],
    "affected-sensors": [320, 321, 314, 315, 316, 317, 318, 319]
  },
  ...
}
```

---

## **2. 파일 형식의 구조**

**파일 시스템**은 다음과 같은 구조로 되어 있습니다:

- **날짜별 디렉토리**: `2018-8-22`, `2018-8-23`, `2018-8-24`, `2018-8-25` 등.
- **교차로별 디렉토리**: 각 날짜 디렉토리 안에 교차로 이름으로 된 폴더들 (예: `'Almond at Julie North'`, `'Weiland at Pauline (Cell) West'` 등).
- **이미지 파일**: 각 교차로 디렉토리 안에 이미지 파일들이 저장되어 있습니다.
  - **파일 이름 형식**: `YYYY-M-D-H-M.jpg` (예: `2018-8-22-14-30.jpg`).
  - **촬영 간격**: 10분마다 한 장씩 촬영된 것으로 보임.

**예시 디렉토리 구조**:

```
/2018-8-22/
  ├── Almond at Julie North/
  │   ├── 2018-8-22-0-0.jpg
  │   ├── 2018-8-22-0-10.jpg
  │   └── ...
  ├── Weiland at Pauline (Cell) West/
  │   ├── 2018-8-22-0-0.jpg
  │   ├── 2018-8-22-0-10.jpg
  │   └── ...
  └── ...
```

---

## **3. 부족한 점 및 차이점**

### **A. JSON 데이터와 이미지 파일 간 직접적인 매핑 정보의 부재**

- **이미지 파일 경로나 이름에 대한 정보가 없음**: JSON 데이터에는 이미지 파일의 경로나 이름이 포함되어 있지 않습니다.
- **사건 위치와 이미지 디렉토리 간의 직접적인 연결 고리 부재**: JSON 데이터의 사건 좌표(위도, 경도)와 이미지가 저장된 디렉토리(교차로 이름) 사이에 직접적인 매핑 정보가 없습니다.

### **B. 위치 정보 매핑의 어려움**

- **디렉토리 이름과 위치 좌표의 매핑 데이터 부재**: 교차로 이름(디렉토리 이름)과 해당 위치(위도, 경도)를 매핑하는 데이터가 없습니다.
- **사건 좌표와 디렉토리 매칭의 어려움**: 사건의 좌표를 기반으로 가장 가까운 디렉토리를 찾으려면 각 디렉토리의 위치 좌표가 필요합니다.

### **C. 시간 정보 매핑의 어려움**

- **시간대 차이 가능성**: 사건 발생 시간과 이미지 촬영 시간이 동일한 시간대를 기준으로 하지 않을 수 있습니다. 이로 인해 시간 매칭에 어려움이 발생할 수 있습니다.
- **이미지 파일의 시간 간격 제한**: 이미지가 10분 간격으로 촬영되므로, 정확한 사건 발생 시점의 이미지를 얻기 어려울 수 있습니다.

### **D. 센서 정보와 이미지 디렉토리 간 매핑 부재**

- **센서 ID와 이미지 디렉토리의 연결 고리 부재**: JSON 데이터에는 `affected-sensors` 정보가 있지만, 이 센서 ID와 이미지 디렉토리가 어떤 관계인지에 대한 정보가 없습니다.
- **센서 위치 정보의 부재**: 센서의 위치(위도, 경도)가 제공되지 않아, 센서 위치를 기반으로 이미지 디렉토리를 매칭하기 어렵습니다.

---

## **4. 해결을 위해 필요한 정보**

### **1) 위치 매핑 파일 생성**

- **디렉토리 이름과 위치 좌표 매핑**: 각 이미지 디렉토리(교차로)의 이름과 해당 위치(위도, 경도)를 매핑한 파일(예: `location_mapping.json`)이 필요합니다.
  - 이 매핑을 통해 사건의 좌표와 가장 가까운 이미지 디렉토리를 찾을 수 있습니다.
- **매핑 파일 예시**:

  ```json
  {
    "Almond at Julie North": [42.12345, -87.12345],
    "Weiland at Pauline (Cell) West": [42.200000, -87.950000],
    ...
  }
  ```

### **2) 센서 정보의 확장**

- **센서 ID와 위치 좌표 매핑**: `affected-sensors`에 포함된 센서 ID와 해당 센서의 위치(위도, 경도)를 매핑한 데이터가 필요합니다.
- **센서 위치와 이미지 디렉토리 매핑**: 센서 위치를 통해 관련된 이미지 디렉토리를 찾을 수 있다면, 사건과 이미지를 연결할 수 있습니다.

### **3) 시간대 정보 확인 및 조정**

- **시간대 통일**: 사건 발생 시간과 이미지 촬영 시간이 동일한 시간대를 기준으로 하고 있는지 확인하고, 필요하다면 시간대를 조정해야 합니다.

### **4) 파일 이름 및 구조 표준화**

- **파일 이름 규칙 확인**: 이미지 파일 이름이 일관된 형식으로 되어 있는지 확인하고, 시간 정보를 정확히 추출할 수 있어야 합니다.

---

## **5. 결론**

현재 상태로는 **JSON 데이터와 이미지 파일 간에 직접적인 매핑을 수행하기 어렵습니다.** 그 이유는 다음과 같습니다:

- **이미지 파일에 대한 정보 부족**: JSON 데이터에 이미지 파일 경로나 이름에 대한 정보가 없습니다.
- **위치 매핑 데이터 부재**: 사건의 좌표와 이미지 디렉토리(교차로 이름)를 연결할 수 있는 매핑 정보가 없습니다.
- **센서 정보의 한계**: `affected-sensors` 정보만으로는 이미지 디렉토리를 특정하기 어렵습니다.

**따라서,** 사건과 이미지를 매칭하기 위해서는 **추가적인 매핑 데이터**(위치 매핑 파일 또는 센서 위치 정보)가 필요합니다. 이 정보를 활용하면 사건의 위치를 기반으로 가장 가까운 이미지 디렉토리를 찾을 수 있고, 사건 발생 시간과 이미지 촬영 시간을 비교하여 적절한 이미지를 선택할 수 있습니다.

---

## **6. 제안 사항**

- **위치 매핑 파일 생성**: 각 이미지 디렉토리의 위치 좌표를 수집하여 매핑 파일을 만듭니다.
- **센서 위치 데이터 수집**: 센서 ID와 해당 센서의 위치를 매핑한 데이터를 확보합니다.
- **시간대 확인 및 조정**: 사건 발생 시간과 이미지 촬영 시간의 시간대를 확인하고 일치시키도록 합니다.
- **코드 수정 및 적용**: 위의 정보를 활용하여 코드를 수정하고, 사건과 이미지를 매칭하는 프로세스를 구현합니다.






다음은 각 폴더의 내용을 간략하게 설명한 **readme.txt** 파일의 요약입니다. 각 부분의 구조에 대한 더 자세한 설명과 시각화는 **readme.pdf**를 참고하세요.

1. **imagedata**:
   - 이미지는 각 주별로 나뉜 폴더에 저장되어 있습니다. 각 zip 파일의 시작과 끝이 해당 폴더의 주를 나타냅니다.
   - 압축을 풀면, 각 날의 이미지는 각각의 .zip 파일에 들어있습니다. 이미지들은 카메라 뷰에 따라 폴더로 정렬됩니다.
   - 뷰의 이름은 교차하는 도로와 카메라가 바라보는 방향을 나타내며, 예를 들어 "Almond at Washington East"와 같은 형식입니다.
   - 각 이미지의 이름은 이미지가 수집된 시간을 나타내며, 형식은 연도-월-일-시간-분.jpg입니다.

2. **graphs**:
   - 각 커뮤니티의 그래프 JSON은 별도의 폴더에 저장되어 있습니다. 각 폴더에는 해당 커뮤니티의 JSON 파일이 들어있습니다.
   - 각 JSON 파일에는 인접 행렬, 거리 행렬, 카메라를 식별하는 센서 사전이 담긴 딕셔너리가 있습니다.

3. **incidents**:
   - 이 폴더에는 보고된 사건들의 원본 Excel 스프레드시트가 들어있으며, "processed-incidents.json" 파일은 지리적으로 위치를 찾을 수 있고 STREETS 데이터셋의 카메라와 함께 있는 사건들을 추출합니다.
   - 이 JSON 파일에는 각 교통 사건에 대한 기록된 정보가 포함되어 있습니다.

4. **roadmasks**:
   - 이 폴더에는 각 카메라 뷰에 대한 수작업으로 주석이 달린 도로 마스크가 들어있습니다. 도로 마스크는 연도별로 나뉜 두 개의 폴더에 저장되어 있습니다.
   - 각 연도 폴더에는 각 차선 유형이 고유한 값을 가지는 .png 형식의 도로 마스크가 있습니다.

5. **trafficcounts**:
   - 이 폴더에는 각 날의 이미지에 대한 교통 데이터를 처리한 파일이 들어있습니다. 데이터는 2018년과 2019년 폴더로 나뉘어 있습니다.
   - 각 날의 교통 데이터에 대해 별도의 JSON 파일이 존재합니다.

6. **vehicleannotations**:
   - 이 폴더에는 Mask R-CNN을 재학습시키기 위한 차량 주석 및 이미지가 들어있습니다.
   - "annotations" 폴더에는 각 차량의 주석된 다각형이 포함된 JSON 파일이 있으며, "images" 폴더에는 이에 상응하는 이미지가 들어있습니다.
   - VGG Annotator 도구를 사용하면 이미지와 주석을 원활하게 시각화할 수 있습니다.

7. **viewclassifiers**:
   - 뷰 분류기는 연도별로 나뉘어 있습니다. 각 연도의 폴더에는 각 카메라 위치에서의 K-최근접 이웃(K-Nearest Neighbor) 분류기를 저장한 .joblib 파일이 있습니다.
   - "clf_sizes_year.json" 파일은 각 분류기에 전달되기 전의 전처리된 후의 특징 벡터 크기를 추적합니다.

8. **detectorweights.h5**:
   - 이 .h5 파일에는 벤치마킹에 사용된 사전 학습된 Mask R-CNN 가중치가 들어있습니다. 이 파일은 GitHub에 저장하기에 너무 커서 여기에 제공됩니다.
   - 사용 방법은 GitHub에 설명되어 있습니다.

9. **trafficstate**:
   - 이 폴더에는 "자유 흐름" 상태인지 "정체" 상태인지를 예측하기 위한 모델을 학습시키기 위한 이미지와 그에 대응하는 주석 JSON 파일이 들어있습니다.
   - 이 파일의 코드와 사용법은 GitHub에 제공됩니다.

---


